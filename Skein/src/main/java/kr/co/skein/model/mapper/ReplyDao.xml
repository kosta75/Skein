<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.skein.model.dao.ReplyDao">

	<!-- 1. 그룹 등록 -->
	<insert id="insertReply" parameterType="kr.co.skein.model.vo.Reply">
		<selectKey order="BEFORE" keyProperty="replySeq" resultType="String">
			SELECT NVL(MAX(TO_NUMBER(ReplySeq)),0)+1 FROM Reply
		</selectKey>
		INSERT INTO Reply(replySeq, boardSeq, email, replyContent, isActivated)
		VALUES(#{replySeq}, #{boardSeq}, #{email}, #{replyContent}, #{isActivated})
	</insert>
	
	<!--리플 목록  -->
	<select id="selectReply" resultType="kr.co.skein.model.vo.Reply">
	  SELECT * FROM (
     SELECT ROWNUM r  , s.*,p.profileinfo from(SELECT m.personalURI, r.replyseq,r.boardseq,r.email,r.replycontent,m.fullname FROM reply r JOIN members m ON r.email = m.email WHERE r.boardseq = #{param1} ORDER BY R.REPLYSEQ DESC)s LEFT OUTER JOIN (SELECT  email,profileinfo FROM profiles WHERE profilecode = 2)p ON s.email = p.email
     ) WHERE r BETWEEN #{param2} AND #{param3} ORDER BY r ASC
      
     
	</select>
	<select id="countReply" resultType="Integer">
		SELECT COUNT( * )-#{param1} FROM reply r JOIN members m ON r.email = m.email WHERE r.boardseq = #{param2}
	</select>
	<!--리플삭제  -->
	<delete id="deleteReply" >
		delete from reply where replySeq=#{replySeq}
	</delete>
	<!--리플 수정-->
	<update id="updateReply">
	  UPDATE reply SET REPLYCONTENT = #{param1} WHERE replySeq=#{param2}
	</update>
	
</mapper>
