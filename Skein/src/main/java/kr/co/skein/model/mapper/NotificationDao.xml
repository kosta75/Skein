<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.skein.model.dao.NotificationDao">

	<!-- 사용자 알림 등록 -->
	<insert id="friendshipNotificationReg" parameterType="kr.co.skein.model.vo.FriendshipNotificationCommand">
		<selectKey order="BEFORE" keyProperty="notificationSeq" resultType="String">
			SELECT NVL(MAX(TO_NUMBER(NotificationSeq)),0)+1 FROM Notifications
		</selectKey>
		INSERT ALL
			INTO Notifications(NotificationSeq, Email, IsRead, CreateDate, NotificationCode)
			VALUES(#{notificationSeq}, #{email}, #{isRead}, SYSDATE, #{notificationCode})
			INTO FriendshipNotification(NotificationSeq, Email, FriendEmail, FriendshipConfirm)
			VALUES(#{notificationSeq},#{email}, #{friendEmail}, #{friendshipConfirm})
		SELECT * FROM DUAL
	</insert>
	
	<!--  친구알림 등록  -->
	
	<!-- 1	공지사항
	2	친구신청
	3	친구신청수락
	4	공유신청
	5	공유신청수락
	6	댓글 -->
	<!-- <insert id="friendshipNotificationReg" parameterType="kr.co.skein.model.vo.Notification">
		<selectKey order="BEFORE" keyProperty="notificationSeq" resultType="String">
			SELECT NVL(MAX(TO_NUMBER(NotificationSeq)),0)+1 FROM Notifications
		</selectKey>
		INSERT ALL
			INTO Notifications(NotificationSeq, Email, IsRead, CreateDate, NotificationCode)
			VALUES(#{notificationSeq}, #{email}, #{isRead}, SYSDATE, #{notificationCode})
			<if test="notificationCode == 1">
			
			</if>
			<if test="notificationCode == 2">
			INTO FriendshipNotification VALUES(#{notificationSeq}, #{email}, #{friendEmail}, #{friendshipConfirm})
			</if>
			<if test="notificationCode == 4">
			INTO FriendshipNotification VALUES(#{notificationSeq}, #{email}, #{friendEmail}, #{friendshipConfirm})
			</if>
			<if test="notificationCode == 6">
			INTO FriendshipNotification VALUES(#{notificationSeq}, #{email}, #{friendEmail}, #{friendshipConfirm})
			</if>
		SELECT * FROM DUAL 
	</insert> -->
	
	<!-- 사용자 알림 조회  -->
	<select id="getNotifications" resultType="kr.co.skein.model.vo.NotificationCountCommand">
		SELECT NotificationCode, COUNT(*) AS groupCount FROM Notifications WHERE email = #{email} GROUP BY notificationcode
	</select>
	
</mapper>